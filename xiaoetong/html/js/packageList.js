$(function(){var e=new Business;e.init();if(GetQueryString("prompt")==1){$(".red_prompt_word").html("小鹅通内容列表全面升级为知识商品，点击查看更多高级功能<a href='/help/system_update' target='_blank'>查看教程</a>");$(".red_prompt").show()}});function Business(){this.toolBoxBtn=true;this.toDetail=true;this.searchObj={state:GetQueryString("state")||0,search_content:GetQueryString("search_content")||""}}Business.prototype={init:function e(){if(sessionStorage.getItem("key")==1){setTimeout(function(){baseUtils.show.blueTip("操作成功")},300);sessionStorage.setItem("key",0)}var t=this;$("#packageList").on("click",".listItem",function(){if(t.toDetail){t.toolBoxBtn=false,t.toDetail=false;var e="/package_detail_page?id="+$(this).data("id");contentDetail(e)}});$("#packageList").on("click",".listItem .toolBox li",function(e){e.stopPropagation();var o=$(e.target),a=o.parentsUntil("#packageList",".listItem").data("id");type=o.data("type");type&&t.toolBoxBtn&&t.toDetail&&(t.tool(type,a),t.toDetail=false)});$("#searchBtn").on("click",function(){var e=$("#selector").val(),t=$.trim($("#searchVal").val());if(!!t){window.location.href="/package_list_page?state="+e+"&search_content="+t}else{window.location.href="/package_list_page?state="+e}});$("#selector").find("option").eq(++this.searchObj.state).attr("selected",true);$("#searchVal").on("keypress",function(e){if(e.keyCode=="13"){$("#searchBtn").click()}}).val(this.searchObj.search_content);$(".selector").on("change",function(){$("#searchBtn").click()})},tool:function e(t,o){switch(t){case"edit":contentDetail("/package_detail_page?id="+o);break;case"toup":this.movePackage(o,true);break;case"todown":this.movePackage(o,false);break;case"soldout":this.isShow(o,false);break;case"putaway":this.isShow(o,true);break;default:console.error("参数错误");break}},movePackage:function e(t,o){var a=this;showLoading();$.ajax("/change_package_weight",{type:"POST",dataType:"json",data:{package_id:t,order_type:o?0:1},success:function e(t){hideLoading();if(t.code==0){sessionStorage.setItem("key",1);console.log(sessionStorage.getItem("key"));reloadPage()}else{a.toolBoxBtn=true;a.toDetail=true;baseUtils.show.redTip(t.msg)}},error:function e(t,o,s){console.error(s);hideLoading();a.toolBoxBtn=true;a.toDetail=true;baseUtils.show.redTip("操作失败，请稍后再试")}})},isShow:function e(t,o){var a=this;showLoading();$.ajax("/change_goods_state",{type:"POST",dataType:"json",data:{goods_id:t,goods_type:0,operate_type:o?0:1},success:function e(t){hideLoading();if(t.code==0){baseUtils.show.blueTip(t.msg);setTimeout(function(){reloadPage()},700)}else{a.toolBoxBtn=true;a.toDetail=true;baseUtils.show.redTip(t.msg)}},error:function e(t,o,s){console.error(s);hideLoading();a.toolBoxBtn=true;a.toDetail=true;baseUtils.show.redTip("操作失败，请稍后再试")}})}};