!function(t){if(t.NJBUS)return t.NJBUS;var r={nj_appid:0,nj_url:"",level:4,ignore:[],b_uid:0,ext_info:null,rate:1,combo_report:-1,repeat:5,on_submit:null,localLog:!1,localLogExpTime:5},e={log_list:[],submit_log_list:[],error_submit_count:[]},n=t.onerror;t.onerror=function(r,e,u,a,s){var l=r;s&&s.stack&&(l=o.processStackMsg(s)),o.isCorrectType(l,"Event")&&(l+=l.type?"--"+l.type+"--"+(l.target?l.target.tagName+"::"+l.target.src:""):""),i.push({msg:l,target:e,rowNum:u,colNum:a}),n&&n.apply(t,arguments)};var o={isCorrectType:function(t,r){return Object.prototype.toString.call(t)==="[object "+(r||"Object")+"]"},isObj:function(t){return"object"==typeof t&&!!t},isEmpty:function(t){return null===t||!o.isCorrectType(t,"Number")&&!t},extend:function(t,r){for(var e in r)t[e]=r[e];return t},processError:function(t){try{if(t.stack){var r=t.stack.match("https?://[^\n]+");r=r?r[0]:"";var e=r.match(":(\\d+):(\\d+)");e||(e=[0,0,0]);return{msg:o.processStackMsg(t),rowNum:e[1],colNum:e[2],target:r.replace(e[0],"")}}return t.name&&t.message&&t.description?{msg:JSON.stringify(t)}:t}catch(r){return t}},processStackMsg:function(t){var r=t.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),e=t.toString();return r.indexOf(e)<0&&(r=e+"@"+r),r},isRepeat:function(t){if(!o.isObj(t))return!0;var n=t.msg;return e.error_submit_count[n]=(parseInt(e.error_submit_count[n],10)||0)+1,e.error_submit_count[n]>r.repeat},logObjToStr:function(t,e){var n=[];if(o.isObj(t)){t.level=t.level||r.level;for(var i in t){var u=t[i];if(!o.isEmpty(u)){if(o.isObj(u))try{u=JSON.stringify(u)}catch(t){u="[BJ_REPORT detect value stringify error] "+t.toString()}n.push('"'+i+'":"'+encodeURIComponent(u)+'"')}}}return n.push('"index":"'+e+'"'),"{"+n.join(",")+"}"},processLog:function(t){if(r.nj_url){for(var n=Math.random()>=r.rate;e.log_list.length;){var i=!1,u=e.log_list.shift();if(u.msg=(u.msg+""||"").substr(0,500),!o.isRepeat(u)){var a=o.logObjToStr(u,e.submit_log_list.length);if(o.isCorrectType(r.ignore,"Array"))for(var s=0,l=r.ignore.length;s<l;s++){var c=r.ignore[s];if(o.isCorrectType(c,"RegExp")&&c.test(a)||o.isCorrectType(c,"Function")&&c(u,a)){i=!0;break}}i||(r.localLog?o.saveLocalLog(a):n||e.submit_log_list.push(a))}}t&&o.submitLog()}},saveLocalLog:function(t){},submitLog:function(){if(e.submit_log_list.length){var t=r.nj_url+e.submit_log_list.join("---")+"&count="+e.submit_log_list.length+"&time="+ +new Date+"&nj_appid="+r.nj_appid+"&level="+r.level+"&b_uid="+r.b_uid+"&ext_info="+r.ext_info;if(r.on_submit&&r.on_submit(t));else{(new Image).src=t}e.submit_log_list=[]}}},i=t.NJBUS={init:function(t){r=t},push:function(t){var n=o.isObj(t)?o.processError(t):{msg:t};return r.ext_info&&!n.ext_info&&(n.ext_info=r.ext_info),n.page_url||(n.page_url=location.href),e.log_list.push(n),o.processLog(!0),i}}}(window),function(t){if(!t.NJBUS)return void console.error("请先加载committer库！");t.NJBUS.wrapAll=function(){e.wrapJquery().wrapModules().wrapSystem()};var r={timeoutkey:null,isFunction:function(t){return"function"==typeof t},merge:function(t,r){for(var e in r)t[e]=r[e]},pushError:function(r){t.NJBUS.push(r)},catNormal:function(e,n){return function(){try{return e.apply(this,n||arguments)}catch(e){if(r.pushError(e),null==r.timeoutkey){var o=t.onerror;t.onerror=function(){},r.timeoutkey=setTimeout(function(){t.onerror=o,r.timeoutkey=null},50)}throw e}}},catArgs:function(t){return function(){for(var e,n=[],o=0,i=arguments.length;o<i;o++)e=arguments[o],r.isFunction(e)&&(e=r.catNormal(e)),n.push(e);return t.apply(this,n)}},catTimeout:function(t){return function(e,n){if("string"==typeof e)try{e=new Function(e)}catch(t){throw t}var o=[].slice.call(arguments,2);return e=r.catNormal(e,o.length&&o),t(e,n)}},letAllArgsTry:function(t,e){return function(){for(var n,o,i=[],u=0,a=arguments.length;u<a;u++)n=arguments[u],r.isFunction(n)&&(n.tryWrap?n=n.tryWrap:(o=r.catNormal(n),n.tryWrap=o,n=o)),i.push(n);return t.apply(e||this,i)}},letObjAllKeyValueTry:function(t){var e,n;for(e in t)n=t[e],r.isFunction(n)&&(t[e]=r.catNormal(n));return t}},e={wrapJquery:function(){var n=t.$;if(!n||!n.event)return e;var o,i;n.zepto?(o=n.fn.on,i=n.fn.off,n.fn.on=r.letAllArgsTry(o),n.fn.off=function(){for(var t,e=[],n=0,o=arguments.length;n<o;n++)t=arguments[n],r.isFunction(t)&&t.tryWrap&&(t=t.tryWrap),e.push(t);return i.apply(this,e)}):t.jQuery&&(o=n.event.add,i=n.event.remove,n.event.add=r.letAllArgsTry(o),n.event.remove=function(){for(var t,e=[],n=0,o=arguments.length;n<o;n++)t=arguments[n],r.isFunction(t)&&t.tryWrap&&(t=t.tryWrap),e.push(t);return i.apply(this,e)});var u=n.ajax;return u&&(n.ajax=function(t,e){return e||(e=t,t=void 0),r.letObjAllKeyValueTry(e),t?u.call(n,t,e):u.call(n,e)}),e},wrapModules:function(){var n=t.require,o=t.define;return o&&o.amd&&n&&(t.require=r.catArgs(n),r.merge(t.require,n),t.define=r.catArgs(o),r.merge(t.define,o)),t.seajs&&o&&(t.define=function(){for(var t,e=[],n=0,i=arguments.length;n<i;n++)t=arguments[n],r.isFunction(t)&&(t=r.catNormal(t),t.toString=function(t){return function(){return t.toString()}}(arguments[n])),e.push(t);return o.apply(this,e)},t.seajs.use=r.catArgs(t.seajs.use),r.merge(t.define,o)),e},wrapSystem:function(){return t.setTimeout=r.catTimeout(t.setTimeout),t.setInterval=r.catTimeout(t.setInterval),e},wrapCustom:function(t){return r.isFunction(t)?r.catNormal(t):r.letObjAllKeyValueTry(t)}}}(window);