$(function(){videoUpload.init();$(".videoUploadCancle").hide()});var is_edit=false;var fileId;var videoGsize;var transcodeNotifyUrl;var videoTypes=["WMV","RMVB","MPG","MPEG","3GP","MP4","AVI","wmv","rmvb","mpg","mpeg","3gp","mp4","avi"];var videoUpload=function(){var e={};var o=function e(o){$.ajax({url:"/getsigv4",data:JSON.stringify({Action:"GetVodSignatureV2"}),type:"POST",dataType:"json",success:function e(i){console.log(i);if(i.result){console.log("成功");o(i.result)}else{console.log("获取签名失败");return"获取签名失败"}}})};e.init=function(){$("#video_file").click(function(){$("#uploadVideoNow-file").click()});function e(e,o){var i=e.length;while(i--){if(e[i]===o){return true}}console.log("找不到");return false}var i=function e(o,i){var t={};return t.type=o.name.slice(o.name.match(/\.[^\.]+$/).index+1),t.name=i||o.name.slice(0,o.name.match(/\.[^\.]+$/).index),t.size=o.size,t.error="",(void 0==t.name||""==t.name||/[:*?,<>\'\"\\]/g.test(t.name))&&(t.error='文件名不得包含 / : * ? "  < > 等字符'),t};$("#uploadVideoNow-file").on("change",function(t){var a=this.files[0];var n=i(a,a.name);console.log(n);console.log(n.error);if(n.error!=""){baseUtils.show.redTip(n.error);$("#uploadVideoNow-file").val("");return false}if(!e(videoTypes,n.type)){baseUtils.show.redTip("上传的文件必须为视频文件哦~");$("#uploadVideoNow-file").val("");return false}var r=a.size;videoGsize=Number(r/(1024*1024)).toFixed(2);if(videoGsize>1024){baseUtils.show.redTip("请将视频文件压缩到 1G 以内");return false}var s=qcVideo.ugcUploader.start({videoFile:a,getSignature:o,allowAudio:0,isTranscode:true,transcodeNotifyUrl:transcodeNotifyUrl,success:function e(o){console.log("上传成功");console.log(o);is_edit=false;$(".videoUploadLineA").css("width","100%");$(".videoPercent").text("已完成");$(".uploadRatio span:nth-of-type(1)").text(videoGsize+"M");$(".uploadRatio span:nth-of-type(2)").text(videoGsize+"M")},error:function e(o){console.log("上传失败");console.log(o)},progress:function e(o){is_edit=true;$("#videoName").hide();$(".videoUploadBox").fadeIn(300);$(".videoBoxTitle").text(o.name);$(".videoSize").text(videoGsize+"M");if(o.shacurr<1){$(".videoPercent").text("视频正在解析中");$(".uploadRatio span").text("");$(".videoUploadLineA").css("width","0%")}else if(o.shacurr==1){var i=parseFloat(videoGsize)*parseFloat(o.curr);i=i.toFixed(2);var t=Number(o.curr*100).toFixed(2);if(t>100)t=100;$(".videoUploadLineA").css("width",t+"%");$(".videoPercent").text(t+"%");$(".uploadRatio span:nth-of-type(1)").text(i+"M");$(".uploadRatio span:nth-of-type(2)").text(videoGsize+"M")}if(o.type=="video"){console.log(o)}},finish:function e(o){console.log("finish");console.log(o);fileId=o.fileId;VideoName=o.videoName}})})};return e}();