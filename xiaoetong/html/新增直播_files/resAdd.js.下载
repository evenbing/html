$(function(){resAdd.init()});var id;var pageType;var resourceType;var uploadChannelType=GetQueryString("upload_channel_type")||1;var resourceFree=uploadChannelType==1?2:null;var packageId=GetQueryString("package_id");var resourceParams;var packageName;var columnState=1;var show_resourcecount=1;var classArray=[];var fileAudio1Size;var resAudio1Length;var AudioName;var fileAudio2Size;var resAudio2Length;var tryAudioName;var VideoName;var aliveState;var roleParams=[];var aliveT=0;var backURL="";var prevVal;var if_push,push_ahead;var playState=0;var is_distribute=$("#is_distribute").val();var currentDate;var resAdd=function(){var e={};var a;function i(e){var a=null;if(window.createObjectURL!=undefined){a=window.createObjectURL(e)}else if(window.URL!=undefined){a=window.URL.createObjectURL(e)}else if(window.webkitURL!=undefined){a=window.webkitURL.createObjectURL(e)}return a}function o(e){if(window.revokeObjectURL!=undefined){window.revokeObjectURL(e)}else if(window.URL!=undefined){window.URL.revokeObjectURL(e)}else if(window.webkitURL!=undefined){window.webkitURL.revokeObjectURL(e)}}function t(e,t,l,n){if(e&&e.length>0){var r=e[0];var s=i(r);a=(r.size/(1024*1024)).toFixed(2);resAudio1Lengh=r.duration;if(l=="Audio1"){fileAudio1Size=a;var d=document.getElementById("resourceTime");d.src=s;d.onload=function(){o(s)};d.load()}if(l=="Audio2"){fileAudio2Size=a;var c=document.getElementById("tryTime");c.src=s;c.onload=function(){o(s)}}if(t=="audio"){var u=r.name;var p,v;v=u.lastIndexOf(".");if(v!=-1){p=u.substr(v+1).toUpperCase();p=p.toLowerCase();if(p!="mp3"&&p!="m4a"){baseUtils.show.blueTip("请上传音频类型的文件哦~!");if(l=="Audio1"){$(".upLoadAudio1").val("")}else{$(".upLoadAudio2").val("")}return}}else{document.all.submit_upload.disabled=true;if(l=="Audio1"){$(".upLoadAudio1").val("")}else{$(".upLoadAudio2").val("")}baseUtils.show.blueTip("请上传音频类型的文件哦~!");return}$("#audioURL"+l).hide();$(".uploadBox"+l).fadeIn(300);$(".upload"+l+"Name").html(r.name);$(".upload"+l+"Size span").html(a);$(".uploadPLine"+l).show().find(".uploadPLineActive"+l).css("width","0");$(".uploadPersent"+l).html("");if(l=="Audio1"){AudioName=r.name}else if(l=="Audio2"){tryAudioName=r.name}}if($uploadFile.checkFileSize(r,n)){$uploadFile.uploadRes(r,t,function(e){if(t=="audio"){var a=parseInt(e*100);$(".uploadPLineActive"+l).css("width",a+"%");$(".uploadPersent"+l).text(a+"%")}},function(e){console.log(e);baseUtils.show.blueTip("上传成功！");$(".uploadPersent"+l).text("完成");resUrl=e.data.access_url;console.log(resUrl);$("#"+l+"Url").val(resUrl);if(l=="Audio2"){$(".deleteTryAudio").show()}if(t=="image"){var a=r.name;var i,n;n=a.lastIndexOf(".");if(n!=-1){i=a.substr(n+1).toUpperCase();i=i.toLowerCase();if(i!="jpg"&&i!="png"&&i!="jpeg"&&i!="gif"){baseUtils.show.redTip("请上传图片类型的文件哦~");return}}else{document.all.submit_upload.disabled=true;baseUtils.show.redTip("请上传图片类型的文件哦~");return}$(".previewPic"+l+" img").load(function(){o(s)}).attr("src",s)}},function(e){console.error("上传失败!!!");console.log(e);baseUtils.show.redTip("上传失败！")})}else{baseUtils.show.redTip("上传资源限制在"+n+"MB内！");$(".upLoad"+l).val("")}}else{baseUtils.show.redTip("网络错误，请稍后再试！")}}e.init=function(){resourceType=GetQueryString("type");aliveTimeConfig(".dateSetInput");aliveTimeConfig(".dateSetInputBottom","top-right");$(".upLoadImage1").on("change",function(){t(this.files,"image","Image1",5)});$(".previewPicImage1").click(function(){$(".upLoadImage1").click()});$(".upLoadImage2").on("change",function(){t(this.files,"image","Image2",5)});$(".previewPicImage2").click(function(){$(".upLoadImage2").click()});$(".upLoadImage3").on("change",function(){t(this.files,"image","Image3",5)});$(".previewPicImage3").click(function(){$(".upLoadImage3").click()});$(".upLoadImage4").on("change",function(){t(this.files,"image","Image4",5)});$(".previewPicImage4").click(function(){$(".upLoadImage4").click()});$(".upLoadAudio1").on("change",function(){t(this.files,"audio","Audio1",200)});$(".upLoadAudio2").on("change",function(){t(this.files,"audio","Audio2",200)});$(".deleteTryAudio").click(function(){$(".upLoadAudio2").val("");$(".uploadBoxAudio2").hide();$("#Audio2Url").val("");$(this).hide();$("#audioURLAudio2").remove()});if(is_distribute!=1){var e=$(".resPrize");var a=$(".password");$(".notFreeSelect").click(function(){e.removeAttr("readonly disabled");a.attr({readonly:"readonly",disabled:"disabled"}).val("");resourceFree=2;$("#courseRemind").show()});$(".FreeSelect").click(function(){e.attr({readonly:"readonly",disabled:"disabled"}).val(0);a.attr({readonly:"readonly",disabled:"disabled"}).val("");resourceFree=1;$("#courseRemind").hide();$("#courseRemind option[value=-1]").prop("selected",true);$("#push_ahead").change()});$(".passwordSelect").click(function(){a.removeAttr("readonly disabled");e.attr({readonly:"readonly",disabled:"disabled"}).val(0);resourceFree=1;$("#courseRemind").hide();$("#courseRemind option[value=-1]").prop("selected",true);$("#push_ahead").change()})}push_ahead=$("#push_ahead option:selected").val();if_push=$("#if_push").val()||1;function i(){if(push_ahead==-1){if_push=1}else{if_push=0}}var o=$("#push_ahead");if(o.length>0){console.log(push_ahead);i();console.log(if_push);var l=$("#push_ahead").data("collection");if(l===0){o.on("change",function(e){var a=$(this),t=+a.val();a.find("option[value="+push_ahead+"]").prop("selected",true);console.log(l);if(o.data("setting")===1){if(push_ahead===-1&&t!==-1){var n="您需要到微信公众号后台将您的服务号所在行业设置为“教育/培训”，设置完成后，开启服务号通知方可正常发送模板消息。"+"<br/><a target='_blank' href='/help/instructions#hp5_wx_service' style='margin-top:10px;'>什么是模板消息？</a>";var r={title:"提示",btn:3,oktext:"我已设置",canceltext:"关闭",icon:"blue",onOk:function e(){$.ajax("/has_industry",{type:"GET",dataType:"json",data:{}}).done(function(e){var o=e.ret;if(o==0){a.find("option[value="+t+"]").prop("selected",true);push_ahead=t;i();baseUtils.show.blueTip("模板消息推送开启")}else{baseUtils.show.redTip("无法开启消息推送，请按照提示修改设置")}}).fail(function(e,a,i){console.error(i);baseUtils.show.redTip("网络错误，请稍后再试")})}};$.alert(n,"custom",r);return false}else{push_ahead=t;i();a.find("option[value="+t+"]").prop("selected",true)}}else{if(push_ahead===-1&&t!==-1){a.find("option[value="+t+"]").prop("selected",true);push_ahead=t;i();baseUtils.show.blueTip("模板消息推送开启")}else{push_ahead=t;i();a.find("option[value="+t+"]").prop("selected",true)}}})}else if(l==1){o.on("change",function(e){var a=$(this),o=+a.val();if(push_ahead===-1&&o!==-1){$.get("check_person_goods_message_push",function(e){if(e.code==-1){var t="您尚未开启服务号通知，是否立即开启服务号通知？";var l={title:"提示",btn:3,oktext:"开启通知",canceltext:"关闭",icon:"blue",onOk:function e(){$.ajax("/set_service_notification",{type:"POST",dataType:"json",data:{status:1}}).done(function(e){if(e.code==0){a.find("option[value="+o+"]").prop("selected",true);push_ahead=o;i();baseUtils.show.blueTip("已开启服务号消息通知")}else{baseUtils.show.redTip("操作失败，请稍后再试。")}}).fail(function(e,a,i){console.error(i);baseUtils.show.redTip("网络错误，请稍后再试！")})}};$.alert(t,"custom",l)}else{a.find("option[value="+o+"]").prop("selected",true);push_ahead=o;i();baseUtils.show.blueTip("模板消息推送开启")}})}else{push_ahead=o;i();a.find("option[value="+o+"]").prop("selected",true)}})}}$("#preview").on("click",function(){var e=ue.getContent();document.getElementById("preview_content").innerHTML=e;$(".preview_con").addClass("active");$(".preview_box").addClass("active");document.documentElement.style.overflow="hidden"});$(".preview_con").on("click",function(){$(this).removeClass("active");$("#preview_content").html("");$(".preview_box").removeClass("active");document.documentElement.style.overflow="auto"});$(".videosSelect").click(function(){$(".aliveVideoBox").slideDown(300);aliveT=1;console.log(aliveT);VideoName=null});$(".voiceSelect").click(function(){$(".aliveVideoBox").slideUp(300);aliveT=0;console.log(aliveT)});$(".aliveSelect").click(function(){$(".aliveVideoBox").slideUp(300);aliveT=2;console.log(aliveT)});$(".pptAliveSelect").click(function(){$(".aliveVideoBox").slideUp(300);aliveT=3;console.log(aliveT)});$(".columnShow").click(function(){columnState=0});$(".columnHide").click(function(){columnState=1});$(".countShow").click(function(){show_resourcecount=1});$(".countHide").click(function(){show_resourcecount=0});$(".lastStepBtn").click(function(){window.history.back()});var n=$("#getBack");if(uploadChannelType==1){if(resourceType==4){backURL="/resource_list_page?resource_type=4";n.attr("href",backURL)}else{backURL="/resource_list_page";n.attr("href",backURL)}}else if(uploadChannelType==2){backURL="/package_detail_page?id="+packageId;n.attr("href",backURL)}else if(uploadChannelType==3){backURL="/member_detail_page?id="+packageId;n.attr("href",backURL)}changeSaveFlag(true);var r=$("#serviceToggle");var l=r.data("collection");prevVal=+$("#serviceToggle :radio:checked").val()||null;if(r.length>0){if(l==0&&r.data("setting")==1){r.on("click",":radio",function(e){console.log("hahaha");console.log(l);var a=$(this);var i=+a.val();if(i!==prevVal&&i==1){e.preventDefault();var o="您需要到微信公众号后台将您的服务号所在行业设置为“教育/培训”，设置完成后，开启服务号通知方可正常发送模板消息。"+"<br/><a target='_blank' href='/help/instructions#hp5_wx_service' style='margin-top:10px;'>什么是模板消息？</a>";var t={title:"提示",btn:3,oktext:"我已设置",canceltext:"关闭",icon:"blue",onOk:function e(){$.ajax("/has_industry",{type:"GET",dataType:"json",data:{}}).done(function(e){var o=e.ret;if(o==0){a.prop("checked",true);prevVal=i;baseUtils.show.blueTip("模板消息推送开启")}else{baseUtils.show.redTip("无法开启消息推送，请按照提示修改设置")}}).fail(function(e,a,i){console.error(i);baseUtils.show.redTip("网络错误，请稍后再试！")})}};$.alert(o,"custom",t);return false}else{prevVal=i;params["push_state"]=i;$("#serviceToggle").data("state",i)}})}else{r.on("click",":radio",function(e){e.preventDefault();var a=$(this);var i=a.val();var o=GetQueryString("package_id");var t=$("#dateInput").val();$.get("/check_goods_message_push/"+o+"/"+t,function(e){console.log(e);$("#valid_push").html(e.data.valid_push);if(e.data.has_push>=3){$("#fBtn1").attr("disabled",true);$("#has_push").html(3)}else{$("#has_push").html(e.data.has_push);$("#fBtn1").attr("disabled",false)}if(e.code==-1){if(i!==prevVal&&i==1){var o="您尚未开启服务号通知，是否立即开启服务号通知？";var t={title:"提示",btn:3,oktext:"开启通知",canceltext:"关闭",icon:"blue",onOk:function e(){$.ajax("/set_service_notification",{type:"POST",dataType:"json",data:{status:1}}).done(function(e){if(e.code==0){a.prop("checked",true);prevVal=i;baseUtils.show.blueTip("已开启服务号消息通知")}else{baseUtils.show.redTip("操作失败，请稍后再试。")}}).fail(function(e,a,i){console.error(i);baseUtils.show.redTip("网络错误，请稍后再试！")})}};$.alert(o,"custom",t)}else{prevVal=i;a.prop("checked",true)}}else{if(i!==prevVal&&i==1){prevVal=i;baseUtils.show.blueTip("模板消息推送开启");a.prop("checked",true)}else{prevVal=i;a.prop("checked",true)}}})})}}};return e}();getNowFormatDate();function getNowFormatDate(){var e=new Date;var a="-";var i=":";var o=e.getFullYear();var t=e.getMonth()+1;var l=e.getDate();if(t>=1&&t<=9){t="0"+t}if(l>=0&&l<=9){l="0"+l}currentDate=o+a+t+a+l+" "+e.getHours()+i+e.getMinutes()+i+e.getSeconds();return currentDate}