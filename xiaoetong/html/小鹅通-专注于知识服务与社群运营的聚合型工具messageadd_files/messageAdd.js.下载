var $is_address_right=true;$(document).ready(function(){$.cookie("content_create")?setTopUrlInfo("content_create"):setTopUrlInfo("message_listop");bindElement();$("#sub_input.form-control").bind("input propertychange",function(){var e=document.getElementById("sub_input").value;if(e==""||!e.indexOf("http://")||!e.indexOf("https://")){$(".http_error_tip").addClass("hide");$is_address_right=true}else{$(".http_error_tip").removeClass("hide");$is_address_right=false}});$("#type_selector").change(function(){var e=$(this).children(":selected").val();if(e!=="h5"){$(".http_error_tip").addClass("hide");$(".modal-footer").css({margin:"45px 15px 0"}).css({padding:"30px 0px"});$is_address_right=true}else{$("#sub_input").val("")}});datetimepickerconfig("input[name='send_at']");function e(){var e=new Date;var t="-";var s=":";var i=e.getMonth()+1;var r=e.getDate();var n=e.getHours();var a=e.getMinutes();var o=e.getSeconds();if(i>=1&&i<=9){i="0"+i}if(r>=0&&r<=9){r="0"+r}if(n>=0&&n<=9){n="0"+n}if(a>=0&&a<=9){a="0"+a}if(o>=0&&o<=9){o="0"+o}var l=e.getFullYear()+t+i+t+r+" "+n+s+a+s+o;return l}var t=e();$("input[name='send_at']").val(t);$(".addButton").click(function(){var e=$("input[name='send_at']").val();var t=$("input[name='send_nick_name']").val();var s=$("textarea[name='content']").val();if(e.length==0){window.wxc.xcConfirm("请输入推送时间","error");return false}if(t.length==0){window.wxc.xcConfirm("请输入发送人昵称","error");return false}if(s.length==0){window.wxc.xcConfirm("请输入推送内容","error");return false}if(!$is_address_right){window.wxc.xcConfirm("外部链接输入有问题","error");return false}var i={};i["skip_target"]=$("#sub_selector").find("option:selected").val();i["skip_title"]=$("#sub_selector").find("option:selected").text();var r=$("#type_selector").find("option:selected").val();if($("#message_selector").length>0){i["message_audio"]=$("#message_selector").find("option:selected").val()}else{i["message_audio"]=""}if(r=="audio"){r=2}else if(r=="video"){r=3}else if(r=="alive"){r=7}else if(r=="image_text"){r=1}else if(r=="package"){r=6}else if(r=="h5"){r=5;i["skip_target"]=$("#sub_input").val().trim()}else{r=0;i["skip_target"]=""}i["skip_type"]=r;if(r==2||r==3||r==7||r==1||r==6){if(i["skip_title"]==""){baseUtils.show.blueTip("请选择跳转资源链接!");return false}}i["skip_title"]=$("#url_title").val();$.post("/messagesave",{sendAt:e,sendNickName:t,content:s,params:i},function(e){if(e.ret==0){window.wxc.xcConfirm("推送成功","success");setTimeout(function(){window.location.href="/message"},2e3)}else{window.wxc.xcConfirm("系统繁忙，请稍后再试","error")}})})});function bindElement(){$("#type_selector").on("change",function(){var e=$(this).find("option:selected").val();if(e=="h5"){$("#sub_selector").empty();$("#sub_selector").addClass("hide");$("#sub_input").removeClass("hide");return}else if(e=="no_jump"){$("#sub_selector").empty();$("#sub_selector").removeClass("hide");$("#sub_input").addClass("hide");return}else{$("#sub_selector").empty();$("#sub_selector").removeClass("hide");$("#sub_input").addClass("hide")}$.get("/banner/getResourceList?type="+e,function(e){$("#sub_selector").empty();e=JSON.parse(e);var t=e.length;var s="";for(var i=0;i<t;i++){s+="<option value='"+e[i].id+"'>"+e[i].title+"</option>"}$("#sub_selector").append(s)})})}